---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVUjNpeGFrN2VtODdyT3JKMTJ4QVJXTEtEWjN3d0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd05ESTNNVGt6TVRBd1doY05NakV3TkRJM01Ua3oKTVRBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUMreC91MGJ4SGF0T2pKSExpNzVXY3pYcmlOcTlzbFpCbW9JVUJzWjNpTk1hWEJ4VFlYOXVETwpZeWRNcHYxR1IvYzBsRGU1d29oazJ5U29PYU5GV3l5bEwwZW13QklMWkFTdlQ5cndYSUZnZVF3d0tLWXBBMmFhClduWG1TOGZPeWN2aU43cmNmaDJSbDcza044SDhEaEQxZ05lYktZNEw0bXlPZHU5eGk3SExxWGczdzlkd3R0ZW4KQzFZdnp4QnlnVHlXZDRDZE5Fb3Mvc1VGOGhWVGFZTzh4cW42YVFhTU52T3JKcFJrMjJlL1NkNU1jY0ZXaUxtWApsK1RzRW94MVhRMkR2ekFDWFNhT0xjTjMyY21uc3doaW5JNlNKV0d0TFhOdVBIbkRpbGtlNjBIQlZMVjZjL1NvCmpKTGRyOExFMHU5RTRxbWphNlFSOUR1Ri83cUkyOXdOQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlNwUUdpWGtlemw1QW1yRi9xdkhGTjVTVk5UM3pBZkJnTlZIU01FR0RBV2dCUStPL1g5CmlkTWs1TU1JYjVTcngwdnphVittNVRBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBTEZnMlVVSlRtbUN0b3lkdVdzdEVDTGsvMk1oK3lyZVMvNG9YaXZjYkxSWgprYVFON1VkdlBkSkxkMWdBeTJ5YTZYNXpwMkhPOEdCVFFicHdERk9nRWY0SitGbWEyd2o5UzRiUzhtYXdJOFRiCmNHZXA3NWZNcGt0cTRpekJpQTVlU2ZycUtJTFBBV0dnVGJsdFEwTUZ6SXlqQTdmZUg0NHFjRTFqcVhXZEJ1QnUKSUh0NmJUZlI3ZHd2ck5CalFWTDBmSFNzZ1VPTmk1cDZsamorYXd3ZVdSN2pqUFVETzM0dlZxcDRxWGkxQkwzaQo3MWQ4SWpwWk9DeC9XUGdhUFIrQk9FaFVBSjZJYnUxaHhycU9VcDFwK0hQeUxGTlNBZmIzaEZjS3U1b0xYVkd0Cm1JRC9PVC9rOXlwcFV1eHo0djNMbVAxRnhzeENoWVJ4YU43Mm42RkllclU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBdnNmN3RHOFIyclRveVJ5NHUrVm5NMTY0amF2YkpXUVpxQ0ZBYkdkNGpUR2x3Y1UyCkYvYmd6bU1uVEtiOVJrZjNOSlEzdWNLSVpOc2txRG1qUlZzc3BTOUhwc0FTQzJRRXIwL2E4RnlCWUhrTU1DaW0KS1FObW1scDE1a3ZIenNuTDRqZTYzSDRka1plOTVEZkIvQTRROVlEWG15bU9DK0pzam5idmNZdXh5Nmw0TjhQWApjTGJYcHd0V0w4OFFjb0U4bG5lQW5UUktMUDdGQmZJVlUybUR2TWFwK21rR2pEYnpxeWFVWk50bnYwbmVUSEhCClZvaTVsNWZrN0JLTWRWME5nNzh3QWwwbWppM0RkOW5KcDdNSVlweU9raVZoclMxemJqeDV3NHBaSHV0QndWUzEKZW5QMHFJeVMzYS9DeE5MdlJPS3BvMnVrRWZRN2hmKzZpTnZjRFFJREFRQUJBb0lCQVFDR2E2R05vRFNVUktOQQpFRnlaQnltUHFFMmdoRllFSW1OeGN2eFJaUllyWmEvRXQ0OUZrMDBTSGdxeWwzWWM3dGZlMUEvdmNvRm5qb0JsCmh6Yml4enJOcUdKenV5RDdwWjBuYUx4NlhyTkpwZ0JRYmxPazBpQ1k0T1B4UDdPb244Wm52WnlMZnRDV3BMUEcKK1FKVTloUTg1bXNEaUdQdE83d0JKUXZRbFB6UTRYNUJMVzJvcjZaK0VWUXdmZ2JuYTFIdUYzR3VQc1pubjJHUgpkNjY5UWlJQ29lemZlZVVOYkU2T2NUcDhZcFBPajIxc0Y2YVh0NVI1NTlVZ2JhazZ5WmZtVGZaZjFnVW9JdVVqClpUcUtOT1JGNHJrWmFHeDNqOW1ad2piRnBqZnZVeHYwdmE4M3JpNTdxN3dLalRUV2F6TC9SVDN2ZEc0UjA0V3QKMVgyZ2NwZ0JBb0dCQVBQc3VhTm5KTGRKbEFab0ZNaDRUaVhURXdML0xnSjlnYzZ5WitUazJkK3NHeUxqcHArRQpHTnZNTjlkd0ZheUdLM1ZQV1ZqNXlvdHhyRDJ0VVk1NGVhUXRyTmtja0ZLUjI2RFlFTDFhNzhwSXpqeEZuSzBvCmZQK3NyTGZBK2VrMTkydUtOMEdZaVhFM2ZJMVp6Q3BhUUQ5V3A2TWs3MUpaUGhXaVFtSmdLWXhkQW9HQkFNZzUKeERqaDJLYVdTREovYStvWkpSeE1wNDFnQkpHaEZnTzNSOVplcmFCOWs2dEZ2Q3NHOVBUelZmQ3ZFVGVyTEtBQwprUjU1cTZtRys3YlByaytNZkE1cVEzLzYxOHk0M0hDbUhWUVFpU1piYUg2c0pnaWNJS2dKeWpYOXluYUlOQ3hrClk2OHlIblc2QW1nMVB2YkhBS0RLK0NoeEZBUldQYndsbGJnRDRoTnhBb0dCQU5lQkJQM2R5YTE1ZnlNdDMzYkIKKzJFbG03MWhFQmc1Skc4bVplM3ZWcUpybnNuelVTbkxmbDdxalVkMGltR1RaRi9QVEFQMUpNS1FHbm1mWDllOApqdFBEV3R1eWhidTlpOG9PT3JQZzNNdmVDUDl0RFNCYkRoeWhSVE5QZGp4WlpwQUhYQXhESk9MMi83NnVZRmZtCnhxNXU4OHFLZmpwR0NEajYweVd4Q2VRdEFvR0FmdTN2OE1kcm1wK21nU3k1OHB1aUpRQ0xMMXB4U3dpOWRmbVkKZHROcWFsVnhhYUE1bTJVN29KVXFJL3czZy96bHUwSWxVUlo4dG1tMTVMeGZtbHBLd3JDbXZkajlPUER2L2hHdwpnZnhCbGFsWTR3U3F6OFo2QlV5L2ZkNjNuTkRYa2xUSnhPU1czcmJlazhVOWR4L016Q0lma3pPc0p0dXRJenNJCllMRkZmbUVDZ1lFQTNQSW1xMys2eGQ2aG02b1lFREMxV3FxeXJaTEVqOGpsTjQybyt6MFp5clVsa3NhQnJZQmEKYjRtSEYzYThEa21FcytjdTNZaXJlNGlHS1JvU0xyRzFrSC94alpFcXBPR0lwMy9iNUl0SjJ6RC9GQUx4cmZDbQpkNU1lTjZXRzMrN3dEcTNoMkRDRTFyMk1RdERCT2hnTzZmT1hxckVSV1VUZ1c3OXJNTm9CT1RzPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= 
metadata:
  name: registry-tls
  namespace: default
type: Opaque
